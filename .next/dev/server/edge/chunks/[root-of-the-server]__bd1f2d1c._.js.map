{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { jwtVerify } from 'jose';\r\n\r\nexport async function middleware(request) {\r\n  const token = request.cookies.get('token')?.value;\r\n  const path = request.nextUrl.pathname;\r\n\r\n  // --- 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: ‡∏°‡∏µ Token ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ---\r\n\r\n  // ‡∏Å‡∏£‡∏ì‡∏µ A: ‡πÑ‡∏°‡πà‡∏°‡∏µ Token ‡πÅ‡∏•‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô -> ‡∏î‡∏µ‡∏î‡πÑ‡∏õ Login\r\n  if (!token && path !== '/login') {\r\n    return NextResponse.redirect(new URL('/login', request.url));\r\n  }\r\n\r\n  // ‡∏Å‡∏£‡∏ì‡∏µ B: ‡∏°‡∏µ Token ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Login -> ‡∏î‡∏µ‡∏î‡πÑ‡∏õ Dashboard\r\n  if (token && path === '/login') {\r\n    return NextResponse.redirect(new URL('/Dashboard', request.url));\r\n  }\r\n\r\n  // ‡∏Å‡∏£‡∏ì‡∏µ C: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏™‡∏∏‡∏î (/) -> ‡∏î‡∏µ‡∏î‡πÑ‡∏õ Dashboard\r\n  if (path === '/') {\r\n    return NextResponse.redirect(new URL('/Dashboard', request.url));\r\n  }\r\n\r\n  // --- 2. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (Role) ---\r\n  if (token) {\r\n    try {\r\n      const secret = new TextEncoder().encode(process.env.JWT_SECRET);\r\n      const { payload } = await jwtVerify(token, secret);\r\n      \r\n      const role = payload.role?.toLowerCase(); // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß\r\n\r\n      // ==========================================\r\n      // üö´ ‡πÇ‡∏ã‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏é‡πÄ‡∏´‡∏•‡πá‡∏Å (Access Rules)\r\n      // ==========================================\r\n\r\n      // ‡∏Å‡∏é‡∏ó‡∏µ‡πà 1: ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (Accounting)\r\n      if (path.startsWith('/accounting')) {\r\n         \r\n         // ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô: ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ \"‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô\" (/accounting/reimbursement) -> ‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô!\r\n         const isReimbursement = path.startsWith('/accounting/reimbursement');\r\n\r\n         if (!isReimbursement) {\r\n             // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏ä‡πà‡∏ô‡∏à‡∏∞‡πÑ‡∏õ‡∏î‡∏π‡∏á‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô) -> ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\r\n             if (role !== 'super_admin' && role !== 'admin') {\r\n                return NextResponse.rewrite(new URL('/unauthorized', request.url));\r\n             }\r\n         }\r\n      }\r\n\r\n      // ‡∏Å‡∏é‡∏ó‡∏µ‡πà 3: ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Inventory) -> ‡∏´‡πâ‡∏≤‡∏° Employee\r\n      if (path.startsWith('/inventory') && role === 'employee') {\r\n         return NextResponse.redirect(new URL('/Dashboard', request.url));\r\n      }\r\n      \r\n      // ‡∏Å‡∏é‡∏ó‡∏µ‡πà 4: ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (Sales) -> ‡∏´‡πâ‡∏≤‡∏° Employee (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)\r\n      if (path.startsWith('/sales') && role === 'employee') {\r\n         return NextResponse.redirect(new URL('/Dashboard', request.url));\r\n      }\r\n\r\n    } catch (error) {\r\n      // ‚ùå Token ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ -> ‡πÉ‡∏´‡πâ Login ‡πÉ‡∏´‡∏°‡πà\r\n      const response = NextResponse.redirect(new URL('/login', request.url));\r\n      response.cookies.delete('token');\r\n      return response;\r\n    }\r\n  }\r\n\r\n  // ‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏î‡πà‡∏≤‡∏ô -> ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ú‡πà‡∏≤‡∏ô\r\n  return NextResponse.next();\r\n}\r\n\r\n// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤ Middleware ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏´‡∏ô‡∏ö‡πâ‡∏≤‡∏á\r\nexport const config = {\r\n  matcher: [\r\n    '/',                    \r\n    '/login',               \r\n    '/Dashboard/:path*',    \r\n    '/accounting/:path*',   \r\n    '/hr/:path*',           \r\n    '/inventory/:path*',    \r\n    '/sales/:path*',        \r\n    '/attendance/:path*'    \r\n  ],\r\n};"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe,WAAW,OAAO;IACtC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;IAC5C,MAAM,OAAO,QAAQ,OAAO,CAAC,QAAQ;IAErC,4CAA4C;IAE5C,6DAA6D;IAC7D,IAAI,CAAC,SAAS,SAAS,UAAU;QAC/B,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,mEAAmE;IACnE,IAAI,SAAS,SAAS,UAAU;QAC9B,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;IAChE;IAEA,gDAAgD;IAChD,IAAI,SAAS,KAAK;QAChB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;IAChE;IAEA,+CAA+C;IAC/C,IAAI,OAAO;QACT,IAAI;YACF,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU;YAC9D,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,4KAAS,EAAC,OAAO;YAE3C,MAAM,OAAO,QAAQ,IAAI,EAAE,eAAe,2BAA2B;YAErE,6CAA6C;YAC7C,oCAAoC;YACpC,6CAA6C;YAE7C,kCAAkC;YAClC,IAAI,KAAK,UAAU,CAAC,gBAAgB;gBAEjC,wFAAwF;gBACxF,MAAM,kBAAkB,KAAK,UAAU,CAAC;gBAExC,IAAI,CAAC,iBAAiB;oBAClB,yEAAyE;oBACzE,IAAI,SAAS,iBAAiB,SAAS,SAAS;wBAC7C,OAAO,gMAAY,CAAC,OAAO,CAAC,IAAI,IAAI,iBAAiB,QAAQ,GAAG;oBACnE;gBACJ;YACH;YAEA,uDAAuD;YACvD,IAAI,KAAK,UAAU,CAAC,iBAAiB,SAAS,YAAY;gBACvD,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;YACjE;YAEA,4DAA4D;YAC5D,IAAI,KAAK,UAAU,CAAC,aAAa,SAAS,YAAY;gBACnD,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;YACjE;QAEF,EAAE,OAAO,OAAO;YACd,oCAAoC;YACpC,MAAM,WAAW,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YACpE,SAAS,OAAO,CAAC,MAAM,CAAC;YACxB,OAAO;QACT;IACF;IAEA,6BAA6B;IAC7B,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;AACH"}}]
}