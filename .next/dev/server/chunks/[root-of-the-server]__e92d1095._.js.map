{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\r\n\r\nconst dbConfig = {\r\n  host: process.env.DB_HOST,\r\n  user: process.env.DB_USER,\r\n  password: process.env.DB_PASSWORD,\r\n  database: process.env.DB_NAME,\r\n  port: process.env.DB_PORT,\r\n  waitForConnections: true,\r\n  connectionLimit: 30, // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô connection ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô pool\r\n  queueLimit: 0,\r\n  enableKeepAlive: true,\r\n  keepAliveInitialDelay: 10000,\r\n\r\n\r\n};\r\n\r\n// --- ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Singleton ---\r\n// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ pool ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á? ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏¥‡∏°\r\n// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≥‡∏ï‡∏≠‡∏ô Hot Reload)\r\nlet pool;\r\n\r\n// üî• ‡∏ó‡∏µ‡πÄ‡∏î‡πá‡∏î 2: Singleton Pattern\r\n// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ \"‡πÄ‡∏Ñ‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏ß‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?\"\r\nif (process.env.NODE_ENV === 'production') {\r\n  // ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥\r\n  pool = mysql.createPool(dbConfig);\r\n} else {\r\n  // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏≤ (Dev) ‡πÉ‡∏´‡πâ‡∏ù‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà Global\r\n  // ‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß Save ‡πÉ‡∏´‡∏°‡πà Next.js ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î ‡∏Å‡πá‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô\r\n  if (!global.mysqlPool) {\r\n    global.mysqlPool = mysql.createPool(dbConfig);\r\n  }\r\n  pool = global.mysqlPool;\r\n}\r\n\r\nexport default pool;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,iBAAiB;IACjB,uBAAuB;AAGzB;AAEA,2BAA2B;AAC3B,qEAAqE;AACrE,2DAA2D;AAC3D,IAAI;AAEJ,iCAAiC;AACjC,gDAAgD;AAChD;;KAGO;IACL,oDAAoD;IACpD,4FAA4F;IAC5F,IAAI,CAAC,yDAAO,SAAS,EAAE;QACrB,yDAAO,SAAS,GAAG,8IAAK,CAAC,UAAU,CAAC;IACtC;IACA,OAAO,yDAAO,SAAS;AACzB;uCAEe"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/api/sales/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport pool from '../../lib/db'; \r\n\r\n// --- GET: ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ---\r\nexport async function GET() {\r\n  try {\r\n    // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° customer_phone ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥\r\n    const sql = `\r\n      SELECT id, customer_name, customer_phone, total_amount, payment_method, created_at \r\n      FROM orders \r\n      ORDER BY id DESC \r\n      LIMIT 50\r\n    `;\r\n    const [rows] = await pool.query(sql);\r\n    return NextResponse.json(rows);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// --- POST: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞ ‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å ---\r\nexport async function POST(request) {\r\n  const connection = await pool.getConnection(); \r\n  try {\r\n    const body = await request.json();\r\n    \r\n    // ‚úÖ 1. ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ customer_phone ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô (Frontend)\r\n    const { customer_name, customer_phone, customer_address, cart, total_amount, payment_method } = body;\r\n\r\n    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô\r\n    if (!cart || cart.length === 0) {\r\n        return NextResponse.json({ error: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤' }, { status: 400 });\r\n    }\r\n\r\n    await connection.beginTransaction();\r\n\r\n    // ‚úÖ 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° customer_phone ‡∏•‡∏á‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏Ç‡∏µ‡∏î '-')\r\n    const [orderResult] = await connection.query(\r\n      'INSERT INTO orders (customer_name, customer_phone, customer_address, total_amount, payment_method) VALUES (?, ?, ?, ?, ?)',\r\n      [\r\n        customer_name || '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', \r\n        customer_phone || '-',   // ‚úÖ ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£\r\n        customer_address || '', \r\n        total_amount, \r\n        payment_method\r\n      ]\r\n    );\r\n    const orderId = orderResult.insertId;\r\n\r\n    for (const item of cart) {\r\n      // 3. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡πà‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å)\r\n      const [productCheck] = await connection.query(\r\n        'SELECT quantity FROM products WHERE id = ? FOR UPDATE', \r\n        [item.id]\r\n      );\r\n      \r\n      const currentStock = productCheck[0]?.quantity || 0;\r\n\r\n      if (productCheck.length === 0 || currentStock < item.qty) {\r\n        throw new Error(`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ \"${item.name}\" ‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${currentStock})`);\r\n      }\r\n\r\n      // 4. ‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å\r\n      await connection.query(\r\n        'UPDATE products SET quantity = quantity - ? WHERE id = ?',\r\n        [item.qty, item.id]\r\n      );\r\n\r\n      // 5. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á order_items\r\n      await connection.query(\r\n        'INSERT INTO order_items (order_id, product_id, product_name, quantity, price_per_unit) VALUES (?, ?, ?, ?, ?)',\r\n        [orderId, item.id, item.name, item.qty, item.price]\r\n      );\r\n    }\r\n\r\n    await connection.commit();\r\n    \r\n    return NextResponse.json({ \r\n        success: true, \r\n        message: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',\r\n        orderId: orderId \r\n    });\r\n\r\n  } catch (error) {\r\n    await connection.rollback();\r\n    console.error(\"Sale Error:\", error);\r\n    return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n  } finally {\r\n    connection.release();\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,eAAe;IACpB,IAAI;QACF,wEAAwE;QACxE,MAAM,MAAM,CAAC;;;;;IAKb,CAAC;QACD,MAAM,CAAC,KAAK,GAAG,MAAM,oIAAI,CAAC,KAAK,CAAC;QAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF;AAGO,eAAe,KAAK,OAAO;IAChC,MAAM,aAAa,MAAM,oIAAI,CAAC,aAAa;IAC3C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,+DAA+D;QAC/D,MAAM,EAAE,aAAa,EAAE,cAAc,EAAE,gBAAgB,EAAE,IAAI,EAAE,YAAY,EAAE,cAAc,EAAE,GAAG;QAEhG,yBAAyB;QACzB,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,WAAW,gBAAgB;QAEjC,mEAAmE;QACnE,MAAM,CAAC,YAAY,GAAG,MAAM,WAAW,KAAK,CAC1C,6HACA;YACE,iBAAiB;YACjB,kBAAkB;YAClB,oBAAoB;YACpB;YACA;SACD;QAEH,MAAM,UAAU,YAAY,QAAQ;QAEpC,KAAK,MAAM,QAAQ,KAAM;YACvB,8DAA8D;YAC9D,MAAM,CAAC,aAAa,GAAG,MAAM,WAAW,KAAK,CAC3C,yDACA;gBAAC,KAAK,EAAE;aAAC;YAGX,MAAM,eAAe,YAAY,CAAC,EAAE,EAAE,YAAY;YAElD,IAAI,aAAa,MAAM,KAAK,KAAK,eAAe,KAAK,GAAG,EAAE;gBACxD,MAAM,IAAI,MAAM,CAAC,QAAQ,EAAE,KAAK,IAAI,CAAC,oBAAoB,EAAE,aAAa,CAAC,CAAC;YAC5E;YAEA,cAAc;YACd,MAAM,WAAW,KAAK,CACpB,4DACA;gBAAC,KAAK,GAAG;gBAAE,KAAK,EAAE;aAAC;YAGrB,sCAAsC;YACtC,MAAM,WAAW,KAAK,CACpB,iHACA;gBAAC;gBAAS,KAAK,EAAE;gBAAE,KAAK,IAAI;gBAAE,KAAK,GAAG;gBAAE,KAAK,KAAK;aAAC;QAEvD;QAEA,MAAM,WAAW,MAAM;QAEvB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,SAAS;YACT,SAAS;QACb;IAEF,EAAE,OAAO,OAAO;QACd,MAAM,WAAW,QAAQ;QACzB,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnF,SAAU;QACR,WAAW,OAAO;IACpB;AACF"}}]
}