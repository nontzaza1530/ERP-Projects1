{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/api/accounting/invoices/%5Bid%5D/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport mysql from 'mysql2/promise';\r\n\r\nconst dbConfig = {\r\n    host: process.env.DB_HOST || '127.0.0.1',\r\n    user: process.env.DB_USER || 'root',\r\n    password: process.env.DB_PASSWORD || '',\r\n    database: process.env.DB_NAME || 'erp_system',\r\n    port: process.env.DB_PORT ? parseInt(process.env.DB_PORT) : 3306,\r\n    connectTimeout: 10000\r\n};\r\n\r\n// 1. GET: ดึงข้อมูลบิลใบเดียว (พร้อมรายการสินค้า)\r\nexport async function GET(request, { params }) {\r\n    // ✅ แก้ไขตรงนี้: ต้อง await params ก่อนดึง id\r\n    const { id } = await params; \r\n    \r\n    let connection;\r\n    try {\r\n        connection = await mysql.createConnection(dbConfig);\r\n        \r\n        // ... โค้ดส่วนดึงข้อมูลเหมือนเดิม ...\r\n        const [invoices] = await connection.execute('SELECT * FROM invoices WHERE id = ?', [id]);\r\n        if (invoices.length === 0) return NextResponse.json({ error: 'Invoice not found' }, { status: 404 });\r\n\r\n        const [items] = await connection.execute('SELECT * FROM invoice_items WHERE invoice_id = ?', [id]);\r\n\r\n        await connection.end();\r\n        return NextResponse.json({ invoice: invoices[0], items });\r\n    } catch (error) {\r\n        console.error(\"API Error:\", error); // แนะนำให้ log error ดูด้วย\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n\r\n// 2. PUT: อัปเดตสถานะ (เช่น กดรับเงิน / ยกเลิก)\r\nexport async function PUT(request, { params }) {\r\n    const { id } = await params;\r\n    const body = await request.json(); // รับค่า { status: 'paid' }\r\n    let connection;\r\n    try {\r\n        connection = await mysql.createConnection(dbConfig);\r\n        await connection.execute('UPDATE invoices SET status = ? WHERE id = ?', [body.status, id]);\r\n        await connection.end();\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n\r\n// 3. DELETE: ลบเอกสาร\r\nexport async function DELETE(request, { params }) {\r\n    const { id } = await params;\r\n    let connection;\r\n    try {\r\n        connection = await mysql.createConnection(dbConfig);\r\n        await connection.execute('DELETE FROM invoices WHERE id = ?', [id]);\r\n        await connection.end();\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,WAAW;IACb,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,MAAM,QAAQ,GAAG,CAAC,OAAO,GAAG,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC5D,gBAAgB;AACpB;AAGO,eAAe,IAAI,OAAO,EAAE,EAAE,MAAM,EAAE;IACzC,8CAA8C;IAC9C,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IAErB,IAAI;IACJ,IAAI;QACA,aAAa,MAAM,8IAAK,CAAC,gBAAgB,CAAC;QAE1C,sCAAsC;QACtC,MAAM,CAAC,SAAS,GAAG,MAAM,WAAW,OAAO,CAAC,uCAAuC;YAAC;SAAG;QACvF,IAAI,SAAS,MAAM,KAAK,GAAG,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;QAElG,MAAM,CAAC,MAAM,GAAG,MAAM,WAAW,OAAO,CAAC,oDAAoD;YAAC;SAAG;QAEjG,MAAM,WAAW,GAAG;QACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS,QAAQ,CAAC,EAAE;YAAE;QAAM;IAC3D,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,cAAc,QAAQ,4BAA4B;QAChE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ;AAGO,eAAe,IAAI,OAAO,EAAE,EAAE,MAAM,EAAE;IACzC,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,MAAM,OAAO,MAAM,QAAQ,IAAI,IAAI,4BAA4B;IAC/D,IAAI;IACJ,IAAI;QACA,aAAa,MAAM,8IAAK,CAAC,gBAAgB,CAAC;QAC1C,MAAM,WAAW,OAAO,CAAC,+CAA+C;YAAC,KAAK,MAAM;YAAE;SAAG;QACzF,MAAM,WAAW,GAAG;QACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ;AAGO,eAAe,OAAO,OAAO,EAAE,EAAE,MAAM,EAAE;IAC5C,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,IAAI;IACJ,IAAI;QACA,aAAa,MAAM,8IAAK,CAAC,gBAAgB,CAAC;QAC1C,MAAM,WAAW,OAAO,CAAC,qCAAqC;YAAC;SAAG;QAClE,MAAM,WAAW,GAAG;QACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ"}}]
}