{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/api/production/documents/%5BId%5D/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport mysql from 'mysql2/promise';\r\nimport { unlink } from 'fs/promises';\r\nimport path from 'path';\r\n\r\nexport async function DELETE(req, { params }) {\r\n    try {\r\n        // ‚úÖ 1. ‡πÅ‡∏Å‡πâ‡∏à‡∏∏‡∏î‡∏ï‡∏≤‡∏¢ Next.js 15: ‡∏ï‡πâ‡∏≠‡∏á await params ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠\r\n        const resolvedParams = await params;\r\n        const { id } = resolvedParams;\r\n\r\n        if (!id) {\r\n            return NextResponse.json({ error: \"Document ID is missing\" }, { status: 400 });\r\n        }\r\n\r\n        console.log(\"üóëÔ∏è Deleting Document ID:\", id);\r\n\r\n        // ‚úÖ 2. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÉ‡∏ä‡πâ Config ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö GET/POST)\r\n        const connection = await mysql.createConnection({\r\n            host: process.env.DB_HOST || '127.0.0.1',\r\n            user: process.env.DB_USER || 'root',\r\n            password: process.env.DB_PASSWORD || '',\r\n            database: process.env.DB_NAME || 'erp_project',\r\n            port: process.env.DB_PORT ? parseInt(process.env.DB_PORT) : 3306,\r\n            connectTimeout: 10000\r\n        });\r\n\r\n        // 3. ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á\r\n        const [rows] = await connection.execute('SELECT file_path FROM project_documents WHERE id = ?', [id]);\r\n        \r\n        if (rows.length > 0) {\r\n            const relativePath = rows[0].file_path; \r\n            // ‡πÅ‡∏õ‡∏•‡∏á Path ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢\r\n            const safePath = relativePath.startsWith('/') ? relativePath.slice(1) : relativePath;\r\n            const absolutePath = path.join(process.cwd(), 'public', safePath);\r\n            \r\n            try { \r\n                await unlink(absolutePath); // ‡∏™‡∏±‡πà‡∏á‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå\r\n                console.log(\"‚úÖ File deleted from disk:\", absolutePath);\r\n            } catch (e) { \r\n                console.warn(\"‚ö†Ô∏è File not found on disk (skipping delete):\", e.message); \r\n            }\r\n        }\r\n\r\n        // 4. ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\r\n        await connection.execute('DELETE FROM project_documents WHERE id = ?', [id]);\r\n        await connection.end();\r\n\r\n        return NextResponse.json({ message: \"Deleted successfully\" });\r\n\r\n    } catch (error) {\r\n        console.error(\"‚ùå DELETE ERROR:\", error);\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,OAAO,GAAG,EAAE,EAAE,MAAM,EAAE;IACxC,IAAI;QACA,wDAAwD;QACxD,MAAM,iBAAiB,MAAM;QAC7B,MAAM,EAAE,EAAE,EAAE,GAAG;QAEf,IAAI,CAAC,IAAI;YACL,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,QAAQ,GAAG,CAAC,6BAA6B;QAEzC,qEAAqE;QACrE,MAAM,aAAa,MAAM,8IAAK,CAAC,gBAAgB,CAAC;YAC5C,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;YACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;YACjC,MAAM,QAAQ,GAAG,CAAC,OAAO,GAAG,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC5D,gBAAgB;QACpB;QAEA,4CAA4C;QAC5C,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,OAAO,CAAC,wDAAwD;YAAC;SAAG;QAEpG,IAAI,KAAK,MAAM,GAAG,GAAG;YACjB,MAAM,eAAe,IAAI,CAAC,EAAE,CAAC,SAAS;YACtC,iCAAiC;YACjC,MAAM,WAAW,aAAa,UAAU,CAAC,OAAO,aAAa,KAAK,CAAC,KAAK;YACxE,MAAM,eAAe,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;YAExD,IAAI;gBACA,MAAM,IAAA,+HAAM,EAAC,eAAe,aAAa;gBACzC,QAAQ,GAAG,CAAC,6BAA6B;YAC7C,EAAE,OAAO,GAAG;gBACR,QAAQ,IAAI,CAAC,gDAAgD,EAAE,OAAO;YAC1E;QACJ;QAEA,6BAA6B;QAC7B,MAAM,WAAW,OAAO,CAAC,8CAA8C;YAAC;SAAG;QAC3E,MAAM,WAAW,GAAG;QAEpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAuB;IAE/D,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ"}}]
}