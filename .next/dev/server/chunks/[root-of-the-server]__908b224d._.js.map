{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/api/production/documents/%5BdocId%5D/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport mysql from 'mysql2/promise';\r\nimport { unlink } from 'fs/promises';\r\nimport path from 'path';\r\n\r\nexport async function DELETE(req, { params }) {\r\n    const { id } = params;\r\n    try {\r\n        const connection = await mysql.createConnection({\r\n            host: process.env.DB_HOST,\r\n            user: process.env.DB_USER,\r\n            password: process.env.DB_PASSWORD,\r\n            database: process.env.DB_NAME,\r\n            port: process.env.DB_PORT,\r\n        });\r\n\r\n        // 1. ค้นหา Path ไฟล์เพื่อลบไฟล์จริง\r\n        const [rows] = await connection.execute('SELECT file_path FROM project_documents WHERE id = ?', [id]);\r\n        if (rows.length > 0) {\r\n            const absolutePath = path.join(process.cwd(), 'public', rows[0].file_path);\r\n            try { await unlink(absolutePath); } catch (e) { console.log(\"File not found on disk\"); }\r\n        }\r\n\r\n        // 2. ลบข้อมูลใน DB\r\n        await connection.execute('DELETE FROM project_documents WHERE id = ?', [id]);\r\n        await connection.end();\r\n\r\n        return NextResponse.json({ message: \"Deleted\" });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,OAAO,GAAG,EAAE,EAAE,MAAM,EAAE;IACxC,MAAM,EAAE,EAAE,EAAE,GAAG;IACf,IAAI;QACA,MAAM,aAAa,MAAM,8IAAK,CAAC,gBAAgB,CAAC;YAC5C,MAAM,QAAQ,GAAG,CAAC,OAAO;YACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;YACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;YACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;YAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO;QAC7B;QAEA,oCAAoC;QACpC,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,OAAO,CAAC,wDAAwD;YAAC;SAAG;QACpG,IAAI,KAAK,MAAM,GAAG,GAAG;YACjB,MAAM,eAAe,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,IAAI,CAAC,EAAE,CAAC,SAAS;YACzE,IAAI;gBAAE,MAAM,IAAA,+HAAM,EAAC;YAAe,EAAE,OAAO,GAAG;gBAAE,QAAQ,GAAG,CAAC;YAA2B;QAC3F;QAEA,mBAAmB;QACnB,MAAM,WAAW,OAAO,CAAC,8CAA8C;YAAC;SAAG;QAC3E,MAAM,WAAW,GAAG;QAEpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAU;IAClD,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ"}}]
}