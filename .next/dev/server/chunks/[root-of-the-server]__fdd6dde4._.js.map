{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\r\n\r\nconst dbConfig = {\r\n  host: process.env.DB_HOST,\r\n  user: process.env.DB_USER,\r\n  password: process.env.DB_PASSWORD,\r\n  database: process.env.DB_NAME,\r\n  port: process.env.DB_PORT,\r\n  waitForConnections: true,\r\n  connectionLimit: 30, // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô connection ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô pool\r\n  queueLimit: 0,\r\n  enableKeepAlive: true,\r\n  keepAliveInitialDelay: 10000,\r\n\r\n\r\n};\r\n\r\n// --- ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Singleton ---\r\n// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ pool ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á? ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏¥‡∏°\r\n// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≥‡∏ï‡∏≠‡∏ô Hot Reload)\r\nlet pool;\r\n\r\n// üî• ‡∏ó‡∏µ‡πÄ‡∏î‡πá‡∏î 2: Singleton Pattern\r\n// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ \"‡πÄ‡∏Ñ‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏ß‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?\"\r\nif (process.env.NODE_ENV === 'production') {\r\n  // ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥\r\n  pool = mysql.createPool(dbConfig);\r\n} else {\r\n  // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏≤ (Dev) ‡πÉ‡∏´‡πâ‡∏ù‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà Global\r\n  // ‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß Save ‡πÉ‡∏´‡∏°‡πà Next.js ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î ‡∏Å‡πá‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô\r\n  if (!global.mysqlPool) {\r\n    global.mysqlPool = mysql.createPool(dbConfig);\r\n  }\r\n  pool = global.mysqlPool;\r\n}\r\n\r\nexport default pool;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,iBAAiB;IACjB,uBAAuB;AAGzB;AAEA,2BAA2B;AAC3B,qEAAqE;AACrE,2DAA2D;AAC3D,IAAI;AAEJ,iCAAiC;AACjC,gDAAgD;AAChD;;KAGO;IACL,oDAAoD;IACpD,4FAA4F;IAC5F,IAAI,CAAC,yDAAO,SAAS,EAAE;QACrB,yDAAO,SAAS,GAAG,8IAAK,CAAC,UAAU,CAAC;IACtC;IACA,OAAO,yDAAO,SAAS;AACzB;uCAEe"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/api/production/projects/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport pool from '../../../lib/db';\r\n\r\n// ‚úÖ 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥\r\nasync function createAutoNotifications(connection) {\r\n  try {\r\n    const today = new Date().toISOString().split('T')[0];\r\n\r\n    // ‡∏´‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏ï‡∏±‡∏î completed, canceled ‡∏≠‡∏≠‡∏Å) ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á\r\n    const [projects] = await connection.query(`\r\n        SELECT p.* FROM projects p \r\n        WHERE p.status NOT IN ('completed', 'canceled') \r\n        AND p.due_date IS NOT NULL\r\n    `);\r\n\r\n    for (const project of projects) {\r\n        const dueDate = new Date(project.due_date);\r\n        const now = new Date();\r\n        const diffTime = dueDate - now;\r\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠\r\n\r\n        let notifType = null;\r\n        let title = '';\r\n        let message = '';\r\n\r\n        // üö® ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç A: ‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á (Overdue)\r\n        if (diffDays < 0) {\r\n            notifType = 'danger';\r\n            title = `‚ö†Ô∏è ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤: ${project.project_name}`;\r\n            message = `‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏°‡∏≤ ${Math.abs(diffDays)} ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πà‡∏ß‡∏ô`;\r\n        } \r\n        // ‚ö†Ô∏è ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç B: ‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î (Upcoming) ‡πÉ‡∏ô 3 ‡∏ß‡∏±‡∏ô\r\n        else if (diffDays >= 0 && diffDays <= 3) {\r\n            notifType = 'warning';\r\n            title = `‚è≥ ‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î: ${project.project_name}`;\r\n            message = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å ${diffDays} ‡∏ß‡∏±‡∏ô ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö`;\r\n        }\r\n\r\n        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô\r\n        if (notifType) {\r\n            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ \"‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ\" ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (‡∏Å‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πâ‡∏≥‡∏£‡∏±‡∏ß‡πÜ)\r\n            const [existing] = await connection.query(`\r\n                SELECT id FROM notifications \r\n                WHERE title = ? AND DATE(created_at) = ?\r\n            `, [title, today]);\r\n\r\n            if (existing.length === 0) {\r\n                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á notifications (user_id = 0 ‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á Admin/System)\r\n                await connection.query(`\r\n                    INSERT INTO notifications (user_id, title, message, type, link)\r\n                    VALUES (0, ?, ?, ?, ?)\r\n                `, [title, message, notifType, `/production/project/${project.id}`]);\r\n                \r\n                // console.log(`Auto-Notify Created: ${title}`);\r\n            }\r\n        }\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Auto Notify Error:\", err);\r\n  }\r\n}\r\n\r\n// ‚úÖ 2. GET: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÅ‡∏•‡∏∞‡πÅ‡∏≠‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢)\r\nexport async function GET() {\r\n  let connection;\r\n  try {\r\n    connection = await pool.getConnection(); // ‡∏Ç‡∏≠ Connection ‡πÅ‡∏ö‡∏ö manual\r\n\r\n    // üî• ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á)\r\n    await createAutoNotifications(connection);\r\n\r\n    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥\r\n    const [rows] = await connection.query(`\r\n      SELECT \r\n        p.*,\r\n        COALESCE(SUM(c.amount), 0) as total_cost \r\n      FROM projects p\r\n      LEFT JOIN project_costs c ON p.id = c.project_id\r\n      GROUP BY p.id\r\n      ORDER BY p.created_at DESC\r\n    `);\r\n    \r\n    return NextResponse.json(rows);\r\n\r\n  } catch (error) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  } finally {\r\n    if (connection) connection.release(); // ‡∏Ñ‡∏∑‡∏ô Connection ‡πÄ‡∏™‡∏°‡∏≠\r\n  }\r\n}\r\n\r\n// 3. POST: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)\r\nexport async function POST(request) {\r\n  try {\r\n    const body = await request.json();\r\n    const { project_name, customer_name, start_date, due_date, budget, sale_price, description } = body;\r\n\r\n    if (!project_name) {\r\n        return NextResponse.json({ error: 'Missing Project Name' }, { status: 400 });\r\n    }\r\n\r\n    const [res] = await pool.query(`\r\n      INSERT INTO projects (project_name, customer_name, start_date, due_date, budget, sale_price, description, status)\r\n      VALUES (?, ?, ?, ?, ?, ?, ?, 'pending')\r\n    `, [project_name, customer_name, start_date, due_date, budget || 0, sale_price || 0, description]);\r\n\r\n    return NextResponse.json({ success: true, id: res.insertId });\r\n\r\n  } catch (error) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":"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"}}]
}