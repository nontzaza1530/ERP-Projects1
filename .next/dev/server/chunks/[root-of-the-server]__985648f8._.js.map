{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/lib/db.js"],"sourcesContent":["import mysql from 'mysql2/promise';\r\n\r\nconst dbConfig = {\r\n  host: process.env.DB_HOST,\r\n  user: process.env.DB_USER,\r\n  password: process.env.DB_PASSWORD,\r\n  database: process.env.DB_NAME,\r\n  port: process.env.DB_PORT,\r\n  waitForConnections: true,\r\n  connectionLimit: 30, // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô connection ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÉ‡∏ô pool\r\n  queueLimit: 0,\r\n  enableKeepAlive: true,\r\n  keepAliveInitialDelay: 10000,\r\n\r\n\r\n};\r\n\r\n// --- ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Singleton ---\r\n// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ pool ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á? ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏¥‡∏°\r\n// ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≥‡∏ï‡∏≠‡∏ô Hot Reload)\r\nlet pool;\r\n\r\n// üî• ‡∏ó‡∏µ‡πÄ‡∏î‡πá‡∏î 2: Singleton Pattern\r\n// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ \"‡πÄ‡∏Ñ‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏ß‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?\"\r\nif (process.env.NODE_ENV === 'production') {\r\n  // ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥\r\n  pool = mysql.createPool(dbConfig);\r\n} else {\r\n  // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏≤ (Dev) ‡πÉ‡∏´‡πâ‡∏ù‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà Global\r\n  // ‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß Save ‡πÉ‡∏´‡∏°‡πà Next.js ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î ‡∏Å‡πá‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô\r\n  if (!global.mysqlPool) {\r\n    global.mysqlPool = mysql.createPool(dbConfig);\r\n  }\r\n  pool = global.mysqlPool;\r\n}\r\n\r\nexport default pool;"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,WAAW;IACf,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;IACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO;IACzB,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,iBAAiB;IACjB,uBAAuB;AAGzB;AAEA,2BAA2B;AAC3B,qEAAqE;AACrE,2DAA2D;AAC3D,IAAI;AAEJ,iCAAiC;AACjC,gDAAgD;AAChD;;KAGO;IACL,oDAAoD;IACpD,4FAA4F;IAC5F,IAAI,CAAC,yDAAO,SAAS,EAAE;QACrB,yDAAO,SAAS,GAAG,8IAAK,CAAC,UAAU,CAAC;IACtC;IACA,OAAO,yDAAO,SAAS;AACzB;uCAEe"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///D:/erp_project/src/app/api/performance/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport pool from '../../lib/db';\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const month = searchParams.get('month');\r\n    const year = searchParams.get('year');\r\n    const type = searchParams.get('type'); // 'list' ‡∏´‡∏£‡∏∑‡∏≠ 'criteria'\r\n\r\n    if (type === 'criteria') {\r\n        // ‡∏î‡∏∂‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô\r\n        const [rows] = await pool.query(\"SELECT * FROM performance_criteria WHERE status = 'active'\");\r\n        return NextResponse.json(rows);\r\n    }\r\n\r\n    // ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏±‡πâ‡∏ô\r\n    const [rows] = await pool.query(`\r\n        SELECT e.emp_code, e.first_name, e.last_name, e.position,\r\n               ev.id as eval_id, ev.total_score, ev.grade, ev.status, ev.feedback\r\n        FROM employees e\r\n        LEFT JOIN evaluations ev ON e.emp_code = ev.emp_code AND ev.period_month = ? AND ev.period_year = ?\r\n        WHERE e.status = 'active'\r\n        ORDER BY e.emp_code ASC\r\n    `, [month, year]);\r\n\r\n    return NextResponse.json(rows);\r\n\r\n  } catch (error) {\r\n    return NextResponse.json({ error: error.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    const body = await request.json();\r\n    const { emp_code, month, year, scores, feedback } = body; \r\n    // scores = [{ criteria_id: 1, score: 8 }, { criteria_id: 2, score: 9 }]\r\n\r\n    // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏Å‡∏£‡∏î\r\n    let totalScore = 0;\r\n    \r\n    // ‡∏î‡∏∂‡∏á‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å\r\n    const [criteriaList] = await pool.query(\"SELECT * FROM performance_criteria\");\r\n    \r\n    // Logic: (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ / ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°) * ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å %\r\n    for (const item of scores) {\r\n        const criteria = criteriaList.find(c => c.id === item.criteria_id);\r\n        if (criteria) {\r\n            const weightedScore = (item.score / criteria.max_score) * criteria.weight_percent;\r\n            totalScore += weightedScore;\r\n        }\r\n    }\r\n\r\n    // ‡∏ï‡∏±‡∏î‡πÄ‡∏Å‡∏£‡∏î\r\n    let grade = 'F';\r\n    if (totalScore >= 90) grade = 'A';\r\n    else if (totalScore >= 80) grade = 'B';\r\n    else if (totalScore >= 70) grade = 'C';\r\n    else if (totalScore >= 60) grade = 'D';\r\n\r\n    const connection = await pool.getConnection();\r\n    await connection.beginTransaction();\r\n\r\n    try {\r\n        // 2. Insert/Update Header (evaluations)\r\n        const [resEval] = await connection.query(`\r\n            INSERT INTO evaluations (emp_code, period_month, period_year, total_score, grade, feedback, status)\r\n            VALUES (?, ?, ?, ?, ?, ?, 'Finalized')\r\n            ON DUPLICATE KEY UPDATE \r\n            total_score = VALUES(total_score),\r\n            grade = VALUES(grade),\r\n            feedback = VALUES(feedback),\r\n            status = 'Finalized'\r\n        `, [emp_code, month, year, totalScore, grade, feedback]);\r\n\r\n        // ‡∏´‡∏≤ ID ‡∏Ç‡∏≠‡∏á‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (‡∏ñ‡πâ‡∏≤ Insert ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ä‡πâ insertId, ‡∏ñ‡πâ‡∏≤ Update ‡∏ï‡πâ‡∏≠‡∏á Query ‡∏´‡∏≤)\r\n        let evalId = resEval.insertId;\r\n        if (evalId === 0) {\r\n            const [existing] = await connection.query(\"SELECT id FROM evaluations WHERE emp_code = ? AND period_month = ? AND period_year = ?\", [emp_code, month, year]);\r\n            evalId = existing[0].id;\r\n        }\r\n\r\n        // 3. Insert Details (evaluation_items) - ‡∏•‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà\r\n        await connection.query(\"DELETE FROM evaluation_items WHERE evaluation_id = ?\", [evalId]);\r\n        \r\n        for (const item of scores) {\r\n            await connection.query(`\r\n                INSERT INTO evaluation_items (evaluation_id, criteria_id, score_given)\r\n                VALUES (?, ?, ?)\r\n            `, [evalId, item.criteria_id, item.score]);\r\n        }\r\n\r\n        await connection.commit();\r\n        connection.release();\r\n\r\n        return NextResponse.json({ success: true, message: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' });\r\n\r\n    } catch (err) {\r\n        await connection.rollback();\r\n        connection.release();\r\n        throw err;\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error(error);\r\n    return NextResponse.json({ success: false, message: error.message }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;QAC/B,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,MAAM,OAAO,aAAa,GAAG,CAAC,SAAS,yBAAyB;QAEhE,IAAI,SAAS,YAAY;YACrB,sBAAsB;YACtB,MAAM,CAAC,KAAK,GAAG,MAAM,oIAAI,CAAC,KAAK,CAAC;YAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC7B;QAEA,kDAAkD;QAClD,MAAM,CAAC,KAAK,GAAG,MAAM,oIAAI,CAAC,KAAK,CAAC,CAAC;;;;;;;IAOjC,CAAC,EAAE;YAAC;YAAO;SAAK;QAEhB,OAAO,gJAAY,CAAC,IAAI,CAAC;IAE3B,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF;AAEO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG;QACpD,wEAAwE;QAExE,4BAA4B;QAC5B,IAAI,aAAa;QAEjB,8BAA8B;QAC9B,MAAM,CAAC,aAAa,GAAG,MAAM,oIAAI,CAAC,KAAK,CAAC;QAExC,+CAA+C;QAC/C,KAAK,MAAM,QAAQ,OAAQ;YACvB,MAAM,WAAW,aAAa,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,KAAK,WAAW;YACjE,IAAI,UAAU;gBACV,MAAM,gBAAgB,AAAC,KAAK,KAAK,GAAG,SAAS,SAAS,GAAI,SAAS,cAAc;gBACjF,cAAc;YAClB;QACJ;QAEA,UAAU;QACV,IAAI,QAAQ;QACZ,IAAI,cAAc,IAAI,QAAQ;aACzB,IAAI,cAAc,IAAI,QAAQ;aAC9B,IAAI,cAAc,IAAI,QAAQ;aAC9B,IAAI,cAAc,IAAI,QAAQ;QAEnC,MAAM,aAAa,MAAM,oIAAI,CAAC,aAAa;QAC3C,MAAM,WAAW,gBAAgB;QAEjC,IAAI;YACA,wCAAwC;YACxC,MAAM,CAAC,QAAQ,GAAG,MAAM,WAAW,KAAK,CAAC,CAAC;;;;;;;;QAQ1C,CAAC,EAAE;gBAAC;gBAAU;gBAAO;gBAAM;gBAAY;gBAAO;aAAS;YAEvD,6EAA6E;YAC7E,IAAI,SAAS,QAAQ,QAAQ;YAC7B,IAAI,WAAW,GAAG;gBACd,MAAM,CAAC,SAAS,GAAG,MAAM,WAAW,KAAK,CAAC,0FAA0F;oBAAC;oBAAU;oBAAO;iBAAK;gBAC3J,SAAS,QAAQ,CAAC,EAAE,CAAC,EAAE;YAC3B;YAEA,6DAA6D;YAC7D,MAAM,WAAW,KAAK,CAAC,wDAAwD;gBAAC;aAAO;YAEvF,KAAK,MAAM,QAAQ,OAAQ;gBACvB,MAAM,WAAW,KAAK,CAAC,CAAC;;;YAGxB,CAAC,EAAE;oBAAC;oBAAQ,KAAK,WAAW;oBAAE,KAAK,KAAK;iBAAC;YAC7C;YAEA,MAAM,WAAW,MAAM;YACvB,WAAW,OAAO;YAElB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAM,SAAS;YAA8B;QAErF,EAAE,OAAO,KAAK;YACV,MAAM,WAAW,QAAQ;YACzB,WAAW,OAAO;YAClB,MAAM;QACV;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACF"}}]
}